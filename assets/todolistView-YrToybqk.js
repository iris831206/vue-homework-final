import{r as l,j as b,k as R,c as u,a as e,b as K,d as U,l as O,m as c,t as C,w as z,v as A,n as $,p as j,e as q,o as r,q as F,u as G}from"./index-7vbtwaSz.js";import{a as d,S as w}from"./sweetalert2.all-3AyHTPfb.js";const H={id:"todoListPage",class:"bg-half"},J={class:"todo_sm"},Q={key:1,class:"todo_sm"},W=e("span",null,"您尚未登入",-1),X=[W],Y={class:"conatiner todoListPage vhContainer"},Z={class:"todoList_Content"},ee={class:"inputBox"},te=e("i",{class:"fa fa-plus"},null,-1),se=[te],oe={class:"todoList_list"},ne={class:"todoList_tab"},ae={class:"todoList_items"},le={class:"todoList_item"},ie={class:"todoList_label"},ue=["checked","onChange"],ce=["onDblclick"],re=["onClick"],de=e("i",{class:"fa fa-times"},null,-1),ve=[de],he={key:1,className:"todoList_label"},pe={class:"todoList_statistics"},v="https://todolist-api.hexschool.io",ke={__name:"todolistView",setup(_e){const L=G(),i=l(""),g=l({nickname:"",uid:""}),x=l(""),I=async()=>{try{const t=await d.get(`${v}/users/checkout`,{headers:{Authorization:i.value}});g.value=t.data,p()}catch{x.value="您尚未登入",w.fire({icon:"warning",title:x.value,showConfirmButton:!1,timer:2e3}),L.push("/")}},n=l([]),h=l(""),p=async()=>{const t=await d.get(`${v}/todos`,{headers:{Authorization:i.value}});n.value=t.data.data},B=async()=>{if(!h.value)return;const t={content:h.value};await d.post(`${v}/todos`,t,{headers:{Authorization:i.value}}),h.value="",p()},m=l(""),D=async()=>{try{const t=await d.post(`${v}/users/sign_out`,{},{headers:{Authorization:i.value}});m.value=t.data.message,w.fire({icon:"success",title:m.value,showConfirmButton:!1,timer:1500}),L.push("/")}catch(t){m.value="登出失敗: "+t.message,w.fire({icon:"error",title:m.value})}},a=l("all"),N=b(()=>a.value==="all"?n.value:a.value==="pending"?n.value.filter(t=>!t.status):a.value==="completed"?n.value.filter(t=>t.status):n.value),S=b(()=>n.value.filter(t=>!t.status).length),E=async t=>{await d.patch(`${v}/todos/${t}/toggle`,{},{headers:{Authorization:i.value}}),p()},V=async t=>{await d.delete(`${v}/todos/${t}`,{headers:{Authorization:i.value}}),p()},f=l(""),_=l({}),M=t=>{f.value=t;const s=n.value.findIndex(o=>o.id===t),y=n.value[s];_.value={...y}},T=async()=>{const t=f.value;await d.put(`${v}/todos/${t}`,_.value,{headers:{Authorization:i.value}}),f.value="",_.value={},p()};return R(()=>{const t=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*=\s*([^;]*).*$)|^.*$/,"$1");i.value=t,I()}),(t,s)=>{const y=q("RouterLink");return r(),u("div",H,[e("nav",null,[e("h1",null,[K(y,{to:"/"},{default:U(()=>[e("a",{href:"#",onClick:s[0]||(s[0]=c(()=>{},["prevent"]))},"ONLINE TODO LISTONLINE TODO LIST")]),_:1})]),e("ul",null,[g.value.uid?(r(),u(O,{key:0},[e("li",J,[e("a",{href:"#",onClick:s[1]||(s[1]=c(()=>{},["prevent"]))},[e("span",null,C(g.value.nickname)+"的代辦",1)])]),e("li",null,[e("a",{href:"#",onClick:c(D,["prevent"])},"登出")])],64)):(r(),u("li",Q,X))])]),e("div",Y,[e("div",Z,[e("div",ee,[z(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=o=>h.value=o),placeholder:"請輸入待辦事項"},null,512),[[A,h.value]]),e("a",{href:"#",onClick:c(B,["prevent"])},se)]),e("div",oe,[e("ul",ne,[e("li",null,[e("a",{href:"#",onClick:s[3]||(s[3]=c(o=>a.value="all",["prevent"])),class:$({active:a.value==="all"})},"全部",2)]),e("li",null,[e("a",{href:"#",onClick:s[4]||(s[4]=c(o=>a.value="pending",["prevent"])),class:$({active:a.value==="pending"})},"待完成",2)]),e("li",null,[e("a",{href:"#",onClick:s[5]||(s[5]=c(o=>a.value="completed",["prevent"])),class:$({active:a.value==="completed"})},"已完成",2)])]),e("div",ae,[e("ul",le,[n.value.length?(r(!0),u(O,{key:0},j(N.value,(o,P)=>(r(),u("li",{key:P},[e("label",ie,[e("input",{class:"todoList_input",type:"checkbox",value:"true",checked:o.status,onChange:k=>E(o.id)},null,40,ue),f.value===o.id?z((r(),u("input",{key:0,type:"text","onUpdate:modelValue":s[6]||(s[6]=k=>_.value.content=k),onBlur:T,onKeyup:F(T,["enter"])},null,544)),[[A,_.value.content]]):(r(),u("span",{key:1,onDblclick:k=>M(o.id)},C(o.content),41,ce))]),e("a",{href:"#",onClick:c(k=>V(o.id),["prevent"])},ve,8,re)]))),128)):(r(),u("li",he," 目前尚無待辦事項 "))]),e("div",pe,[e("p",null,C(S.value)+" 個待完成項目",1)])])])])])])}}};export{ke as default};
